<!DOCTYPE html>
<html>
<head>
    <title>DM Chat App</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #chat-box {
            border: 1px solid #ccc;
            height: 300px;
            overflow-y: scroll;
            padding: 10px;
        }
        .msg { margin-bottom: 6px; }
        .me { color: green; }
        .other { color: blue; }
    </style>
</head>
<body>
    <h2>DM Chat App</h2>

    <form method="post">
        <input name="sender" placeholder="Your username" required>
        <input name="receiver" placeholder="Receiver username" required>
        <input name="message" placeholder="Message" required>
        <button type="submit">Send</button>
    </form>

    <hr>

    {% if user %}
        <h3>Messages for {{ user }}</h3>
        <div id="chat-box"></div>
    {% else %}
        <p>Send a message to start chatting.</p>
    {% endif %}

<script>
{% if user %}
const USER = "{{ user }}";
const chatBox = document.getElementById("chat-box");

function loadMessages() {
    fetch(`/api/messages?user=${USER}`)
        .then(res => res.json())
        .then(data => {
            chatBox.innerHTML = "";
            data.forEach(msg => {
                const div = document.createElement("div");
                div.className = "msg " + (msg.sender === USER ? "me" : "other");
                div.innerHTML = `<b>${msg.sender}</b> â†’ <b>${msg.receiver}</b>: ${msg.message}`;
                chatBox.appendChild(div);
            });
            chatBox.scrollTop = chatBox.scrollHeight; // auto-scroll
        });
}

// load first time
loadMessages();
// refresh every 3 seconds
setInterval(loadMessages, 3000);
{% endif %}
</script>

</body>
</html>
