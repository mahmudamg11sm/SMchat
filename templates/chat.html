<!DOCTYPE html>
<html>
<head>
    <title>SM Chat</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>

<div class="chat-container">
    <div class="header">
        Logged in as <b>{{ username }}</b>
    </div>

    <div class="messages" id="chat"></div>

    <div class="input-box">
        <input id="receiver" placeholder="Username ɗin da zaka rubuta wa">
        <input id="msg" placeholder="Rubuta sako...">
        <button onclick="sendMessage()">➤</button>
    </div>
</div>

<script>
const socket = io();
const username = "{{ username }}";

function sendMessage() {
    const msg = document.getElementById("msg").value;
    const receiver = document.getElementById("receiver").value;

    if (!msg || !receiver) return;

    socket.emit("send_message", {
        sender: username,
        receiver: receiver,
        message: msg
    });

    document.getElementById("msg").value = "";
}

socket.on("receive_message", function(data) {
    if (data.sender === username || data.receiver === username) {
        const chat = document.getElementById("chat");
        const div = document.createElement("div");
        div.className = data.sender === username ? "me" : "them";
        div.innerText = data.sender + ": " + data.message;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
    }
});
</script>

</body>
</html>
